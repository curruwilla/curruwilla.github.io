---
import produtos from '../data/produtos.json'
import { Image } from 'astro:assets'

const { 
	sku,
	badge = null, // 'destaque' | 'recomendado' | 'melhor-custo' | 'premium' | null
	showRating = true
} = Astro.props

// Procura produto pelo SKU
const produto = produtos.find((p) => p.sku === sku)

if (!produto) {
	throw new Error(`Produto com SKU "${sku}" n√£o encontrado em produtos.json`)
}

// Configura√ß√£o dos badges
const badgeConfig = {
	'destaque': {
		text: 'Em Destaque',
		gradient: 'from-pink-500 to-rose-500',
		icon: '‚≠ê'
	},
	'recomendado': {
		text: 'Recomendado',
		gradient: 'from-green-500 to-emerald-500',
		icon: 'üëç'
	},
	'melhor-custo': {
		text: 'Melhor Custo-Benef√≠cio',
		gradient: 'from-blue-500 to-cyan-500',
		icon: 'üí∞'
	},
	'premium': {
		text: 'Premium',
		gradient: 'from-purple-500 to-indigo-500',
		icon: 'üíé'
	}
}

const badgeInfo = badge ? badgeConfig[badge] : null
---

<div class={`product-card-wrapper compact`}>
	<div class="w-full group relative flex flex-col lg:flex-row items-stretch overflow-hidden bg-gradient-to-br
	 from-white/95 to-gray-50/95 dark:from-gray-800/95 dark:to-gray-900/95 rounded-3xl backdrop-blur-lg border
	 dark:border-white/10 shadow-xl hover:shadow-2xl transition-all duration-500 hover:-translate-y-1">
		
		<!-- Imagem Section -->
		<div class="relative flex-shrink-0 w-full border-r lg:w-2/5 lg:max-w-md p-3 lg:p-5 bg-white overflow-hidden">
			<!-- Animated background -->
			<div class="absolute inset-0 opacity-30">
				<div class="absolute top-0 -left-1/2 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent rotate-12 animate-shimmer"></div>
			</div>
			
			<!-- Glow effect -->
			<div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4/5 h-4/5 bg-white/20 rounded-full blur-3xl animate-pulse-slow"></div>
			
			<!-- Product Image -->
			{produto.imagem && (
				<Image
					src={produto.imagem}
					width={300}
					height={300}
					quality={100}
					format='webp'
					loading='lazy'
					class='relative z-10 w-full h-auto transition-transform duration-500 group-hover:scale-105 group-hover:rotate-2 rounded-md'
					alt={`Imagem do produto ${produto.nome_curto}`}
				/>
			)}
			
			<!-- Badge -->
			{badgeInfo && (
				<div class={`absolute top-4 right-4 z-20 bg-gradient-to-r ${badgeInfo.gradient} text-white px-4 py-2 rounded-full shadow-lg animate-float backdrop-blur-sm`}>
					<span class="flex items-center gap-1.5 text-xs font-bold tracking-wide uppercase">
						<span>{badgeInfo.icon}</span>
						<span>{badgeInfo.text}</span>
					</span>
				</div>
			)}
		</div>

		<!-- Content Section -->
		<div class={`flex flex-col justify-center flex-grow p-6 lg:p-8`}>
			<!-- Header -->
			<div class="flex items-start justify-between gap-4 mb-4">
				<h3 class={`font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-gray-100
				 dark:to-gray-400 bg-clip-text text-transparent leading-tight text-xl lg:text-2xl`} style="font-size: 1em;margin: 0px;">
					{produto.nome_curto}
				</h3>
				
				{showRating && (
					<div class="flex items-center gap-1 px-3 py-1 bg-yellow-50 dark:bg-yellow-900/30 rounded-full flex-shrink-0">
						<svg class="w-4 h-4 text-yellow-500" viewBox="0 0 24 24" fill="currentColor">
							<path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
						</svg>
						<span class="text-sm font-semibold text-gray-700 dark:text-gray-300">4.8</span>
					</div>
				)}
			</div>
			
			<!-- Description -->
			<p class={`text-gray-600 dark:text-gray-400 leading-relaxed text-sm mb-10`}>
				{produto.descricao}
			</p>

			<!-- Action Buttons -->
			<div class="flex flex-col sm:flex-row gap-1 mt-5">
				{produto.links.amazon && (
					<a
						href={produto.links.amazon}
						target='_blank'
						rel='noopener noreferrer'
						class='group btn-primary bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700'
					>
						<span class="btn-content">
							<span class="text-xs font-bold uppercase tracking-wide">Amazon</span>
						</span>
					</a>
				)}
				
				{produto.links.shopee && (
					<a
						href={produto.links.shopee}
						target='_blank'
						rel='noopener noreferrer'
						class='group btn-primary bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700'
					>
						<span class="btn-content">
							<span class="text-xs font-bold uppercase tracking-wide">Shopee</span>
						</span>
					</a>
				)}
				
				{produto.links.mercado_livre && (
					<a
						href={produto.links.mercado_livre}
						target='_blank'
						rel='noopener noreferrer'
						class='group btn-primary bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700'
					>
						<span class="btn-content">
							<span class="text-xs font-bold uppercase tracking-wide">Mercado Livre</span>
						</span>
					</a>
				)}
			</div>
		</div>
	</div>
</div>

<style>
	.product-card-wrapper {
		@apply w-full my-12 px-4;
	}

	.product-card-wrapper.compact {
		@apply my-8;
	}

	.btn-primary {
		@apply relative flex-1 overflow-hidden rounded-xl font-semibold text-white no-underline;
		@apply px-5 py-3.5 shadow-lg hover:shadow-xl;
		@apply transition-all duration-300 hover:-translate-y-0.5;
	}

	.btn-content {
		@apply relative z-10 flex items-center justify-center gap-2;
	}

	/* Anima√ß√µes customizadas */
	@keyframes shimmer {
		0% { transform: translateX(-100%) rotate(12deg); }
		100% { transform: translateX(200%) rotate(12deg); }
	}

	@keyframes float {
		0%, 100% { transform: translateY(0px); }
		50% { transform: translateY(-10px); }
	}

	@keyframes pulse-slow {
		0%, 100% { opacity: 0.4; transform: translate(-50%, -50%) scale(1); }
		50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.1); }
	}

	.animate-shimmer {
		animation: shimmer 3s infinite;
	}

	.animate-float {
		animation: float 3s ease-in-out infinite;
	}

	.animate-pulse-slow {
		animation: pulse-slow 3s ease-in-out infinite;
	}

	/* Responsive adjustments */
	@media (max-width: 640px) {
		.product-card-wrapper {
			@apply px-2;
		}
	}
</style>