---
import produtos from '../data/produtos.json'

const { 
	sku,
	badge = null, // 'destaque' | 'recomendado' | 'melhor-custo' | 'premium' | null
	variant = 'default' // 'default' | 'minimal' | 'glass'
} = Astro.props

// Procura produto pelo SKU
const produto = produtos.find((p) => p.sku === sku)

if (!produto) {
	throw new Error(`Produto com SKU "${sku}" n√£o encontrado em produtos.json`)
}

// Configura√ß√£o dos badges
const badgeConfig = {
	'destaque': {
		icon: '‚≠ê',
		class: 'text-pink-500'
	},
	'recomendado': {
		icon: 'üëç',
		class: 'text-green-500'
	},
	'melhor-custo': {
		icon: 'üí∞',
		class: 'text-blue-500'
	},
	'premium': {
		icon: 'üíé',
		class: 'text-purple-500'
	}
}

const badgeInfo = badge ? badgeConfig[badge] : null

// Estilos baseados na variante
const containerClasses = {
	'default': 'bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border border-gray-200 dark:border-gray-700',
	'minimal': 'bg-gray-50/50 dark:bg-gray-800/50 border border-gray-200/50 dark:border-gray-700/50',
	'glass': 'bg-white/60 dark:bg-gray-900/60 backdrop-blur-sm border border-white/20 dark:border-gray-700/20'
}
---

<div class="product-compact-wrapper">
	<div class={`${containerClasses[variant]} rounded-lg px-4 py-0 shadow-sm hover:shadow-md transition-all duration-300 hover:-translate-y-0.5`}>
		<div class="flex items-center justify-between gap-4 flex-wrap sm:flex-nowrap">
			<!-- T√≠tulo com badge -->
			<div class="flex items-center gap-4 flex-grow min-w-0 mb-5">
				{badgeInfo && (
					<span class={`${badgeInfo.class} text-lg flex-shrink-0 mt-3`}>
						{badgeInfo.icon}
					</span>
				)}
				<h4 class="font-bold text-gray-900 dark:text-gray-100 text-base truncate">
					{produto.nome_curto}
				</h4>
			</div>

			<!-- Bot√µes em linha -->
			<div class="flex items-center gap-2 flex-shrink-0">
				{produto.links.amazon && (
					<a
						href={produto.links.amazon}
						target='_blank'
						rel='noopener noreferrer'
						class='group btn-inline bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700'
						title="Ver na Amazon"
					>
						<svg class="w-3.5 h-3.5 sm:hidden transition-transform group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
							<path d="M13.958 10.09c0 1.232.029 2.256-.591 3.351-.502.891-1.301 1.438-2.186 1.438-1.214 0-1.922-.924-1.922-2.292 0-2.692 2.415-3.182 4.7-3.182v.685zm3.186 7.705c-.209.189-.512.201-.745.074-1.052-.872-1.238-1.276-1.814-2.106-1.734 1.767-2.962 2.297-5.209 2.297-2.66 0-4.731-1.641-4.731-4.925 0-2.565 1.391-4.309 3.37-5.164 1.715-.754 4.11-.891 5.942-1.095v-.41c0-.752.058-1.641-.386-2.291-.385-.579-1.124-.82-1.775-.82-1.205 0-2.277.618-2.54 1.897-.054.285-.261.567-.549.58l-3.061-.328c-.259-.058-.548-.266-.472-.66.704-3.716 4.06-4.838 7.066-4.838 1.539 0 3.548.41 4.758 1.574 1.538 1.436 1.392 3.352 1.392 5.438v4.923c0 1.481.615 2.13 1.192 2.929.202.287.247.63-.01.838-.644.538-1.789 1.539-2.420 2.099l-.008-.008z"/>
						</svg>
						<span class="hidden sm:inline text-xs font-bold uppercase tracking-wide">Amazon</span>
					</a>
				)}
				
				{produto.links.shopee && (
					<a
						href={produto.links.shopee}
						target='_blank'
						rel='noopener noreferrer'
						class='group btn-inline bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700'
						title="Ver na Shopee"
					>
						<svg class="w-3.5 h-3.5 sm:hidden transition-transform group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
							<path d="M16 8V4l4 4h-4zm0 0v8c0 2.21-1.79 4-4 4s-4-1.79-4-4V8c0-2.21 1.79-4 4-4s4 1.79 4 4z"/>
						</svg>
						<span class="hidden sm:inline text-xs font-bold uppercase tracking-wide">Shopee</span>
					</a>
				)}
				
				{produto.links.mercado_livre && (
					<a
						href={produto.links.mercado_livre}
						target='_blank'
						rel='noopener noreferrer'
						class='group btn-inline bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700'
						title="Ver no Mercado Livre"
					>
						<svg class="w-3.5 h-3.5 sm:hidden transition-transform group-hover:scale-110" viewBox="0 0 24 24" fill="currentColor">
							<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
						</svg>
						<span class="hidden sm:inline text-xs font-bold uppercase tracking-wide">ML</span>
					</a>
				)}
			</div>
		</div>
	</div>
</div>

<style>
	.product-compact-wrapper {
		@apply w-full my-3;
	}

	.btn-inline {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: 0.375rem;
		padding: 0.375rem 0.75rem;
		border-radius: 0.375rem;
		color: white;
		font-weight: 600;
		box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
		transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		text-decoration: none;
		min-width: 36px;
	}

	.btn-inline:hover {
		box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
		transform: translateY(-2px);
	}

	@media (min-width: 640px) {
		.btn-inline {
			padding: 0.5rem 1rem;
			min-width: auto;
		}
	}
</style>